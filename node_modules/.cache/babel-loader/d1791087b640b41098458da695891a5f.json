{"ast":null,"code":"import _defineProperty from \"C:\\\\Users\\\\brito\\\\Desktop\\\\Tareas\\\\Tarea C1 2020\\\\Programacion web\\\\firebase-chat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"C:\\\\Users\\\\brito\\\\Desktop\\\\Tareas\\\\Tarea C1 2020\\\\Programacion web\\\\firebase-chat\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\brito\\\\Desktop\\\\Tareas\\\\Tarea C1 2020\\\\Programacion web\\\\firebase-chat\\\\src\\\\components\\\\Profile.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport TextField from '@material-ui/core/TextField';\nimport Input from '@material-ui/core/Input';\nimport Link from '@material-ui/core/Link';\nimport { Link as RouterLink, withRouter } from 'react-router-dom';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Container from '@material-ui/core/Container';\nimport firebase from 'firebase/app';\nimport 'firebase/database';\nimport 'firebase/auth';\nimport 'firebase/storage';\nimport Alert from './Alert';\nimport CustomAvatar from './CustomAvatar';\nimport { loadUser } from '../utils/dbUtils';\nconst MyLink = React.forwardRef((props, ref) => React.createElement(RouterLink, Object.assign({\n  innerRef: ref\n}, props, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 20\n  },\n  __self: this\n})));\nconst useStyles = makeStyles(theme => ({\n  '@global': {\n    body: {\n      backgroundColor: theme.palette.common.white\n    }\n  },\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center'\n  },\n  form: {\n    width: '100%',\n    // Fix IE 11 issue.\n    marginTop: theme.spacing(3)\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2)\n  },\n  space: {\n    marginTop: 10,\n    marginBottom: 25\n  },\n  filename: {\n    marginLeft: 20\n  },\n  file: {\n    marginTop: 20,\n    marginBottom: 10,\n    marginLeft: '-1px'\n  }\n}));\n\nconst Profile = props => {\n  const classes = useStyles();\n\n  const _useState = useState({\n    name: '',\n    email: '',\n    avatar: ''\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        user = _useState2[0],\n        setUser = _useState2[1];\n\n  const _useState3 = useState(null),\n        _useState4 = _slicedToArray(_useState3, 2),\n        image = _useState4[0],\n        setImage = _useState4[1];\n\n  const _useState5 = useState(null),\n        _useState6 = _slicedToArray(_useState5, 2),\n        alertMessage = _useState6[0],\n        setAlertMessage = _useState6[1];\n\n  const handleChange = e => {\n    setUser(_objectSpread({}, user, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  const handleImage = e => {\n    if (!e.target.files[0]) return;\n    const file = e.target.files[0];\n    setImage({\n      type: file.type.split('/')[1],\n      file\n    });\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    setAlertMessage(null);\n\n    const _firebase$auth = firebase.auth(),\n          currentUser = _firebase$auth.currentUser;\n\n    if (image) {\n      user.avatar = \"\".concat(currentUser.uid, \".\").concat(image.type);\n      firebase.storage().ref(\"/avatars/\".concat(user.avatar)).put(image.file).then(() => {\n        firebase.storage().ref().child(\"/avatars/\".concat(user.avatar)).getDownloadURL().then(url => {\n          setUser(_objectSpread({}, user, {\n            avatar: url\n          }));\n        });\n      });\n    }\n\n    firebase.database().ref(\"/users/\".concat(currentUser.uid)).update(user).then(response => {\n      setAlertMessage({\n        type: 'success',\n        text: 'Perfil actualizado'\n      });\n    }).catch(error => {\n      setAlertMessage({\n        type: 'error',\n        text: error.message\n      });\n    });\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      if (firebase.auth().currentUser) {\n        // leer datos\n        loadUser(firebase.auth().currentUser.uid).then(data => {\n          setUser(data);\n        }, error => {\n          setAlertMessage({\n            type: 'error',\n            message: error.message\n          });\n        });\n      } else {\n        props.history.push('/login');\n      }\n    }, 1000); // eslint-disable-next-line\n  }, []);\n  return React.createElement(Container, {\n    component: \"main\",\n    maxWidth: \"xs\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, React.createElement(CssBaseline, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: classes.paper,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    component: \"h1\",\n    variant: \"h5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \"Mi Perfil\"), React.createElement(\"form\", {\n    className: classes.form,\n    onSubmit: handleSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, React.createElement(Grid, {\n    container: true,\n    justify: \"center\",\n    alignItems: \"center\",\n    direction: \"column\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, React.createElement(CustomAvatar, {\n    name: user.name,\n    avatar: user.avatar,\n    size: \"xl\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: classes.space,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, user.email)), React.createElement(Grid, {\n    container: true,\n    spacing: 2,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(TextField, {\n    autoComplete: \"fname\",\n    name: \"name\",\n    variant: \"outlined\",\n    required: true,\n    fullWidth: true,\n    id: \"name\",\n    label: \"Nombre\",\n    autoFocus: true,\n    value: user.name,\n    onChange: handleChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  })), React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, React.createElement(TextField, {\n    variant: \"outlined\",\n    required: true,\n    fullWidth: true,\n    id: \"email\",\n    label: \"Email Address\",\n    name: \"email\",\n    autoComplete: \"email\",\n    value: user.email,\n    onChange: handleChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  })), React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, React.createElement(Input, {\n    type: \"file\",\n    accept: \"image/*\",\n    id: \"avatar\",\n    name: \"avatar\",\n    style: {\n      width: '1px'\n    },\n    onChange: handleImage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }), React.createElement(\"label\", {\n    htmlFor: \"avatar\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: classes.file,\n    variant: \"contained\",\n    component: \"span\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"Imagen de perfil\"), image && React.createElement(\"span\", {\n    className: classes.filename,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, image.file.name)))), React.createElement(Button, {\n    type: \"submit\",\n    fullWidth: true,\n    variant: \"contained\",\n    color: \"primary\",\n    className: classes.submit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"Guardar Perfil\"), React.createElement(Grid, {\n    container: true,\n    justify: \"flex-end\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, React.createElement(Grid, {\n    item: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/\",\n    component: MyLink,\n    variant: \"body2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, \"Ir al Chat\"))))), alertMessage && React.createElement(Alert, {\n    type: alertMessage.type,\n    message: alertMessage.text,\n    autoclose: 5000,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }));\n};\n\nexport default withRouter(Profile);","map":{"version":3,"sources":["C:\\Users\\brito\\Desktop\\Tareas\\Tarea C1 2020\\Programacion web\\firebase-chat\\src\\components\\Profile.js"],"names":["React","useState","useEffect","Button","CssBaseline","TextField","Input","Link","RouterLink","withRouter","Grid","Typography","makeStyles","Container","firebase","Alert","CustomAvatar","loadUser","MyLink","forwardRef","props","ref","useStyles","theme","body","backgroundColor","palette","common","white","paper","marginTop","spacing","display","flexDirection","alignItems","form","width","submit","margin","space","marginBottom","filename","marginLeft","file","Profile","classes","name","email","avatar","user","setUser","image","setImage","alertMessage","setAlertMessage","handleChange","e","target","value","handleImage","files","type","split","handleSubmit","preventDefault","auth","currentUser","uid","storage","put","then","child","getDownloadURL","url","database","update","response","text","catch","error","message","setTimeout","data","history","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Button from '@material-ui/core/Button';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport TextField from '@material-ui/core/TextField';\nimport Input from '@material-ui/core/Input';\nimport Link from '@material-ui/core/Link';\nimport { Link as RouterLink, withRouter } from 'react-router-dom';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Container from '@material-ui/core/Container';\nimport firebase from 'firebase/app';\nimport 'firebase/database';\nimport 'firebase/auth';\nimport 'firebase/storage';\nimport Alert from './Alert';\nimport CustomAvatar from './CustomAvatar';\nimport { loadUser } from '../utils/dbUtils';\n\nconst MyLink = React.forwardRef((props, ref) => <RouterLink innerRef={ref} {...props} />);\n\nconst useStyles = makeStyles(theme => ({\n  '@global': {\n    body: {\n      backgroundColor: theme.palette.common.white,\n    },\n  },\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  form: {\n    width: '100%', // Fix IE 11 issue.\n    marginTop: theme.spacing(3),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n  space: {\n    marginTop: 10,\n    marginBottom: 25,\n  },\n  filename: {\n    marginLeft: 20,\n  },\n  file: {\n    marginTop: 20,\n    marginBottom: 10,\n    marginLeft: '-1px',\n  }\n}));\n\nconst Profile = (props) => {\n  const classes = useStyles();\n\n  const [user, setUser] = useState({\n    name: '',\n    email: '',\n    avatar: '',\n  });\n\n  const [image, setImage] = useState(null);\n\n  const [alertMessage, setAlertMessage] = useState(null);\n\n  const handleChange = (e) => {\n    setUser({\n      ...user,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  const handleImage = (e) => {\n    if (!e.target.files[0]) return;\n    const file = e.target.files[0];\n    setImage({\n      type: file.type.split('/')[1],\n      file,\n    })\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    setAlertMessage(null);\n    const { currentUser } = firebase.auth();\n\n    if (image) {\n      user.avatar = `${currentUser.uid}.${image.type}`;\n      firebase.storage().ref(`/avatars/${user.avatar}`).put(image.file)\n      .then(() => {\n        firebase.storage().ref().child(`/avatars/${user.avatar}`)\n        .getDownloadURL().then((url) => {\n          setUser({ ...user, avatar: url });\n        });\n      });\n    }\n\n    firebase.database().ref(`/users/${currentUser.uid}`)\n    .update(user)\n    .then(response => {\n      setAlertMessage({type: 'success', text: 'Perfil actualizado' });\n    })\n    .catch(error => {\n      setAlertMessage({type: 'error', text: error.message });\n    });\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      if (firebase.auth().currentUser){\n        // leer datos\n        loadUser(firebase.auth().currentUser.uid)\n        .then(data => { setUser(data); }\n        ,(error) => {\n          setAlertMessage({ type: 'error', message: error.message });\n        });\n      } else {\n        props.history.push('/login');\n      }\n    }, 1000);\n    // eslint-disable-next-line\n  }, []);\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <CssBaseline />\n      <div className={classes.paper}>\n        <Typography component=\"h1\" variant=\"h5\">\n          Mi Perfil\n        </Typography>\n        <form className={classes.form} onSubmit={handleSubmit}>\n          <Grid\n            container\n            justify=\"center\"\n            alignItems=\"center\"\n            direction=\"column\"\n          >\n            <CustomAvatar name={user.name} avatar={user.avatar} size=\"xl\" />\n            <span className={classes.space}>{user.email}</span>\n          </Grid>\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              <TextField\n                autoComplete=\"fname\"\n                name=\"name\"\n                variant=\"outlined\"\n                required\n                fullWidth\n                id=\"name\"\n                label=\"Nombre\"\n                autoFocus\n                value={user.name}\n                onChange={handleChange}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <TextField\n                variant=\"outlined\"\n                required\n                fullWidth\n                id=\"email\"\n                label=\"Email Address\"\n                name=\"email\"\n                autoComplete=\"email\"\n                value={user.email}\n                onChange={handleChange}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <Input\n                type=\"file\"\n                accept=\"image/*\"\n                id=\"avatar\"\n                name=\"avatar\"\n                style={{ width: '1px' }}\n                onChange={handleImage}\n              />\n              <label htmlFor=\"avatar\">\n                <Button className={classes.file} variant=\"contained\" component=\"span\">\n                  Imagen de perfil\n                </Button>\n                {image && (<span className={classes.filename}>\n                  {image.file.name}\n                </span>)}\n              </label>\n            </Grid>\n          </Grid>\n          <Button\n            type=\"submit\"\n            fullWidth\n            variant=\"contained\"\n            color=\"primary\"\n            className={classes.submit}\n          >\n            Guardar Perfil\n          </Button>\n          <Grid container justify=\"flex-end\">\n            <Grid item>\n              <Link to=\"/\" component={MyLink} variant=\"body2\">\n                {\"Ir al Chat\"}\n              </Link>\n            </Grid>\n          </Grid>\n        </form>\n      </div>\n      {alertMessage && \n        <Alert\n          type={alertMessage.type}\n          message={alertMessage.text}\n          autoclose={5000}\n        />\n      }\n    </Container>\n  );\n};\nexport default withRouter(Profile);"]},"metadata":{},"sourceType":"module"}